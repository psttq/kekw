"use strict";
(self["webpackChunkkekw"] = self["webpackChunkkekw"] || []).push([["index"],{

/***/ "./src/Game.ts":
/*!*********************!*\
  !*** ./src/Game.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Game: () => (/* binding */ Game)
/* harmony export */ });
/* harmony import */ var pixi_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pixi.js */ "./node_modules/pixi.js/lib/index.mjs");
/* harmony import */ var _GameObject__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./GameObject */ "./src/GameObject.ts");
/* harmony import */ var _Player__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Player */ "./src/Player.ts");



const SERVER_URL = "wss://217.28.221.89:8123";
class Game {
    constructor() {
        this.pixi_app = new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Application();
        this.gameObjects = [];
        this.addedGameObjects = [];
        this.player_id = -1;
    }
    sendMessage(str) {
        this.websocket.send(str);
    }
    addGameObject(gameObject) {
        this.pixi_app.stage.addChild(gameObject.sprite);
    }
    removeGameObject(gameObject) {
        this.pixi_app.stage.removeChild(gameObject.sprite);
    }
    async _init() {
        await this.pixi_app.init();
        document.body.appendChild(this.pixi_app.canvas);
    }
    async _load_assets() {
        await pixi_js__WEBPACK_IMPORTED_MODULE_0__.Assets.load("./assets/circles/sphere-00.png");
        await pixi_js__WEBPACK_IMPORTED_MODULE_0__.Assets.load("./assets/circles/sphere-01.png");
        await pixi_js__WEBPACK_IMPORTED_MODULE_0__.Assets.load("./assets/circles/sphere-02.png");
    }
    async _game_loop(deltaTime) {
        //WRITE HERE GAME LOOP CODE
        if (this.addedGameObjects.length !== 0) {
            for (let el of this.addedGameObjects) {
                this.addGameObject(el);
            }
            this.addedGameObjects = [];
        }
        this.addGameObject(this.player);
    }
    async _init_websocket() {
        this.websocket = new WebSocket(SERVER_URL);
        let pingInterval;
        this.websocket.onopen = (e) => {
            console.log("CONNECTED");
        };
        this.websocket.onclose = (e) => {
            console.log("DISCONNECTED");
            clearInterval(pingInterval);
        };
        this.websocket.onmessage = (e) => {
            console.log(`RECEIVED: ${e.data}`);
            let data = JSON.parse(e.data);
            let d_gameObjects = data.gameObjects;
            for (let el of d_gameObjects) {
                let ball_sprite = pixi_js__WEBPACK_IMPORTED_MODULE_0__.Sprite.from("./assets/circles/sphere-02.png");
                let ball = new _GameObject__WEBPACK_IMPORTED_MODULE_1__.GameObject(el.id, { x: el.position.x, y: el.position.y }, { width: 50, height: 50 }, ball_sprite, this);
                let go = this.gameObjects.find((x) => x.id == el.id);
                if (!go) {
                    this.gameObjects.push(ball);
                    this.addedGameObjects.push(ball);
                }
                else {
                    console.log(go);
                    go.setPosition({ x: el.position.x, y: el.position.y });
                }
            }
            if (this.player_id === -1) {
                this.player_id = d_gameObjects.at(-1).id;
            }
        };
        this.websocket.onerror = (e) => {
            console.log(`ERROR: ${e}`);
        };
    }
    async run() {
        await this._init();
        await this._load_assets();
        await this._init_websocket();
        let player_sprite = pixi_js__WEBPACK_IMPORTED_MODULE_0__.Sprite.from("./assets/circles/sphere-01.png");
        this.player = new _Player__WEBPACK_IMPORTED_MODULE_2__.Player({ x: 50, y: 100 }, { width: 50, height: 50 }, player_sprite, this);
        this.pixi_app.ticker.add((ticker) => {
            this._game_loop(ticker.deltaTime);
        });
    }
}


/***/ }),

/***/ "./src/GameObject.ts":
/*!***************************!*\
  !*** ./src/GameObject.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GameObject: () => (/* binding */ GameObject)
/* harmony export */ });
class GameObject {
    constructor(id, position, size, sprite, game) {
        this.game = game;
        this.id = id;
        this.sprite = sprite;
        this.sprite.eventMode = "dynamic";
        this.sprite.position.x = position.x;
        this.sprite.position.y = position.y;
        this.sprite.anchor = 0.5;
        this.sprite.width = size.width;
        this.sprite.height = size.height;
        this.setPosition(position);
        this.sprite.texture.source.magFilter = "nearest";
        this.sprite.texture.source.minFilter = "nearest";
        this.updateRotation = true;
    }
    setPosition(position) {
        this.sprite.position.x = position.x;
        this.sprite.position.y = position.y;
    }
    update(deltaTime) { }
}


/***/ }),

/***/ "./src/Player.ts":
/*!***********************!*\
  !*** ./src/Player.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Player: () => (/* binding */ Player)
/* harmony export */ });
/* harmony import */ var _GameObject__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./GameObject */ "./src/GameObject.ts");
/* harmony import */ var pixi_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pixi.js */ "./node_modules/pixi.js/lib/index.mjs");


class Player extends _GameObject__WEBPACK_IMPORTED_MODULE_0__.GameObject {
    constructor(position, size, sprite, game) {
        super(-1, position, size, sprite, game);
        this.updateRotation = false;
        this.velocity = 20;
        this.ballRadius = 50;
        this.vx = 0;
        this.vy = 0;
        this._mouse_x = 0;
        this._mouse_y = 0;
        this.balls = [];
        this.timer = 0;
        this.ball_cd = 5;
        this.timer_started = false;
        this.game = game;
        let ball_position = { x: 0, y: 0 };
        ball_position.x = position.x;
        ball_position.y = position.y - 70;
        let ball_sprite = pixi_js__WEBPACK_IMPORTED_MODULE_1__.Sprite.from("./assets/circles/sphere-02.png");
        this.ball = new _GameObject__WEBPACK_IMPORTED_MODULE_0__.GameObject(0, ball_position, { width: 50, height: 50 }, ball_sprite, game);
        document.addEventListener("keydown", (e) => this.handleKeyDown(e.key));
        document.addEventListener("keyup", (e) => this.handleKeyUp(e.key));
        this.sprite.on("globalmousemove", (e) => {
            this.handleMouseMove(e.x, e.y);
        });
        document.addEventListener("mousedown", (e) => {
            this.handleClick();
        });
    }
    handleMouseMove(mouse_x, mouse_y) {
        this._mouse_x = mouse_x;
        this._mouse_y = mouse_y;
        // this.sprite.position.x = mouse_x;
        // this.sprite.position.y = mouse_y;
        let message = {
            id: this.game.player_id,
            mouse_x: this._mouse_x,
            mouse_y: this._mouse_y
        };
        this.game.sendMessage(JSON.stringify(message));
    }
    onTimerEnd() {
        let ball_position = { x: 0, y: 0 };
        ball_position.x = this.sprite.x;
        ball_position.y = this.sprite.y - 70;
        let ball_sprite = pixi_js__WEBPACK_IMPORTED_MODULE_1__.Sprite.from("./assets/circles/sphere-02.png");
        this.ball = new _GameObject__WEBPACK_IMPORTED_MODULE_0__.GameObject(0, ball_position, { width: 50, height: 50 }, ball_sprite, this.game);
        this.game.addGameObject(this.ball);
    }
    update(deltaTime) {
        if (this.ball) {
            let vec_x = this._mouse_x - this.sprite.x;
            let vec_y = this._mouse_y - this.sprite.y;
            let length = Math.sqrt(vec_x * vec_x + vec_y * vec_y);
            vec_x /= length;
            vec_y /= length;
            let ball_position_x = this.sprite.x + vec_x * (this.ballRadius + 10);
            let ball_position_y = this.sprite.y + vec_y * (this.ballRadius + 10);
            if (Number.isNaN(ball_position_x) || Number.isNaN(ball_position_y))
                return;
            this.ball.setPosition({ x: ball_position_x, y: ball_position_y });
            this.ball.update(deltaTime);
        }
        for (let ball of this.balls)
            ball.update(deltaTime);
        if (this.timer_started) {
            this.timer -= deltaTime;
            if (this.timer < 0) {
                this.onTimerEnd();
                this.timer_started = false;
            }
        }
        super.update(deltaTime);
    }
    handleClick() {
        if (!this.ball)
            return;
        let vec_x = this._mouse_x - this.sprite.x;
        let vec_y = this._mouse_y - this.sprite.y;
        let length = Math.sqrt(vec_x * vec_x + vec_y * vec_y);
        vec_x /= length;
        vec_y /= length;
        let force = 60;
        vec_x *= force;
        vec_y *= force;
        // Matter.Body.applyForce(this.ball.body, this.ball.body.position, {
        //   x: vec_x,
        //   y: vec_y
        // });
        this.balls.push(this.ball);
        this.ball = undefined;
        this.timer = this.ball_cd;
        this.timer_started = true;
    }
    handleKeyDown(key) { }
    handleKeyUp(key) { }
}


/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Game__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Game */ "./src/Game.ts");

document.body.style.backgroundColor = "#181818";
function removeItem(arr, value) {
    const index = arr.indexOf(value);
    if (index > -1) {
        arr.splice(index, 1);
    }
    return arr;
}
const main = async () => {
    let game = new _Game__WEBPACK_IMPORTED_MODULE_0__.Game();
    game.run();
};
main();


/***/ })

},
/******/ __webpack_require__ => { // webpackRuntimeModules
/******/ var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
/******/ __webpack_require__.O(0, ["npm.pixi.js","npm.xmldom","npm.pixi","npm.ismobilejs","npm.parse-svg-path","npm.earcut"], () => (__webpack_exec__("./src/index.ts")));
/******/ var __webpack_exports__ = __webpack_require__.O();
/******/ }
]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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a3cvLi9zcmMvR2FtZU9iamVjdC50cyIsIndlYnBhY2s6Ly9rZWt3Ly4vc3JjL1BsYXllci50cyIsIndlYnBhY2s6Ly9rZWt3Ly4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFBJWEkgZnJvbSBcInBpeGkuanNcIjtcbmltcG9ydCB7IEdhbWVPYmplY3QgfSBmcm9tIFwiLi9HYW1lT2JqZWN0XCI7XG5pbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi9QbGF5ZXJcIjtcblxuY29uc3QgU0VSVkVSX1VSTCA9IFwid3NzOi8vMjE3LjI4LjIyMS44OTo4MTIzXCI7XG5cbmV4cG9ydCBjbGFzcyBHYW1lIHtcbiAgbWF0dGVyX2VuZ2luZTogTWF0dGVyLkVuZ2luZTtcbiAgcGl4aV9hcHA6IFBJWEkuQXBwbGljYXRpb247XG5cbiAgd2Vic29ja2V0OiBXZWJTb2NrZXQ7XG4gIGdhbWVPYmplY3RzOiBHYW1lT2JqZWN0W107XG4gIGFkZGVkR2FtZU9iamVjdHM6IEdhbWVPYmplY3RbXTtcblxuICBwbGF5ZXJfaWQ6IG51bWJlcjtcblxuICBwbGF5ZXI6IFBsYXllcjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnBpeGlfYXBwID0gbmV3IFBJWEkuQXBwbGljYXRpb24oKTtcbiAgICB0aGlzLmdhbWVPYmplY3RzID0gW107XG4gICAgdGhpcy5hZGRlZEdhbWVPYmplY3RzID0gW107XG4gICAgdGhpcy5wbGF5ZXJfaWQgPSAtMTtcbiAgfVxuXG4gIHNlbmRNZXNzYWdlKHN0cjogc3RyaW5nKSB7XG4gICAgdGhpcy53ZWJzb2NrZXQuc2VuZChzdHIpO1xuICB9XG5cbiAgYWRkR2FtZU9iamVjdChnYW1lT2JqZWN0OiBHYW1lT2JqZWN0KSB7XG4gICAgdGhpcy5waXhpX2FwcC5zdGFnZS5hZGRDaGlsZChnYW1lT2JqZWN0LnNwcml0ZSk7XG4gIH1cblxuICByZW1vdmVHYW1lT2JqZWN0KGdhbWVPYmplY3Q6IEdhbWVPYmplY3QpIHtcbiAgICB0aGlzLnBpeGlfYXBwLnN0YWdlLnJlbW92ZUNoaWxkKGdhbWVPYmplY3Quc3ByaXRlKTtcbiAgfVxuXG4gIGFzeW5jIF9pbml0KCkge1xuICAgIGF3YWl0IHRoaXMucGl4aV9hcHAuaW5pdCgpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5waXhpX2FwcC5jYW52YXMpO1xuICB9XG5cbiAgYXN5bmMgX2xvYWRfYXNzZXRzKCkge1xuICAgIGF3YWl0IFBJWEkuQXNzZXRzLmxvYWQoXCIuL2Fzc2V0cy9jaXJjbGVzL3NwaGVyZS0wMC5wbmdcIik7XG4gICAgYXdhaXQgUElYSS5Bc3NldHMubG9hZChcIi4vYXNzZXRzL2NpcmNsZXMvc3BoZXJlLTAxLnBuZ1wiKTtcbiAgICBhd2FpdCBQSVhJLkFzc2V0cy5sb2FkKFwiLi9hc3NldHMvY2lyY2xlcy9zcGhlcmUtMDIucG5nXCIpO1xuICB9XG5cbiAgYXN5bmMgX2dhbWVfbG9vcChkZWx0YVRpbWU6IG51bWJlcikge1xuICAgIC8vV1JJVEUgSEVSRSBHQU1FIExPT1AgQ09ERVxuICAgIGlmICh0aGlzLmFkZGVkR2FtZU9iamVjdHMubGVuZ3RoICE9PSAwKSB7XG4gICAgICBmb3IgKGxldCBlbCBvZiB0aGlzLmFkZGVkR2FtZU9iamVjdHMpIHtcbiAgICAgICAgdGhpcy5hZGRHYW1lT2JqZWN0KGVsKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYWRkZWRHYW1lT2JqZWN0cyA9IFtdO1xuICAgIH1cbiAgICB0aGlzLmFkZEdhbWVPYmplY3QodGhpcy5wbGF5ZXIpO1xuICB9XG5cbiAgYXN5bmMgX2luaXRfd2Vic29ja2V0KCkge1xuICAgIHRoaXMud2Vic29ja2V0ID0gbmV3IFdlYlNvY2tldChTRVJWRVJfVVJMKTtcbiAgICBsZXQgcGluZ0ludGVydmFsOiBOb2RlSlMuVGltZW91dDtcbiAgICB0aGlzLndlYnNvY2tldC5vbm9wZW4gPSAoZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJDT05ORUNURURcIik7XG4gICAgfTtcblxuICAgIHRoaXMud2Vic29ja2V0Lm9uY2xvc2UgPSAoZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJESVNDT05ORUNURURcIik7XG4gICAgICBjbGVhckludGVydmFsKHBpbmdJbnRlcnZhbCk7XG4gICAgfTtcblxuICAgIHRoaXMud2Vic29ja2V0Lm9ubWVzc2FnZSA9IChlKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgUkVDRUlWRUQ6ICR7ZS5kYXRhfWApO1xuICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKGUuZGF0YSk7XG4gICAgICBsZXQgZF9nYW1lT2JqZWN0cyA9IGRhdGEuZ2FtZU9iamVjdHM7XG5cbiAgICAgIGZvciAobGV0IGVsIG9mIGRfZ2FtZU9iamVjdHMpIHtcbiAgICAgICAgbGV0IGJhbGxfc3ByaXRlID0gUElYSS5TcHJpdGUuZnJvbShcIi4vYXNzZXRzL2NpcmNsZXMvc3BoZXJlLTAyLnBuZ1wiKTtcbiAgICAgICAgbGV0IGJhbGwgPSBuZXcgR2FtZU9iamVjdChcbiAgICAgICAgICBlbC5pZCxcbiAgICAgICAgICB7IHg6IGVsLnBvc2l0aW9uLngsIHk6IGVsLnBvc2l0aW9uLnkgfSxcbiAgICAgICAgICB7IHdpZHRoOiA1MCwgaGVpZ2h0OiA1MCB9LFxuICAgICAgICAgIGJhbGxfc3ByaXRlLFxuICAgICAgICAgIHRoaXNcbiAgICAgICAgKTtcbiAgICAgICAgbGV0IGdvID0gdGhpcy5nYW1lT2JqZWN0cy5maW5kKCh4KSA9PiB4LmlkID09IGVsLmlkKTtcbiAgICAgICAgaWYgKCFnbykge1xuICAgICAgICAgIHRoaXMuZ2FtZU9iamVjdHMucHVzaChiYWxsKTtcbiAgICAgICAgICB0aGlzLmFkZGVkR2FtZU9iamVjdHMucHVzaChiYWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhnbyk7XG4gICAgICAgICAgZ28uc2V0UG9zaXRpb24oeyB4OiBlbC5wb3NpdGlvbi54LCB5OiBlbC5wb3NpdGlvbi55IH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5wbGF5ZXJfaWQgPT09IC0xKSB7XG4gICAgICAgIHRoaXMucGxheWVyX2lkID0gZF9nYW1lT2JqZWN0cy5hdCgtMSkuaWQ7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMud2Vic29ja2V0Lm9uZXJyb3IgPSAoZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYEVSUk9SOiAke2V9YCk7XG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIHJ1bigpIHtcbiAgICBhd2FpdCB0aGlzLl9pbml0KCk7XG4gICAgYXdhaXQgdGhpcy5fbG9hZF9hc3NldHMoKTtcbiAgICBhd2FpdCB0aGlzLl9pbml0X3dlYnNvY2tldCgpO1xuICAgIGxldCBwbGF5ZXJfc3ByaXRlID0gUElYSS5TcHJpdGUuZnJvbShcIi4vYXNzZXRzL2NpcmNsZXMvc3BoZXJlLTAxLnBuZ1wiKTtcbiAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIoXG4gICAgICB7IHg6IDUwLCB5OiAxMDAgfSxcbiAgICAgIHsgd2lkdGg6IDUwLCBoZWlnaHQ6IDUwIH0sXG4gICAgICBwbGF5ZXJfc3ByaXRlLFxuICAgICAgdGhpc1xuICAgICk7XG4gICAgdGhpcy5waXhpX2FwcC50aWNrZXIuYWRkKCh0aWNrZXIpID0+IHtcbiAgICAgIHRoaXMuX2dhbWVfbG9vcCh0aWNrZXIuZGVsdGFUaW1lKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0ICogYXMgUElYSSBmcm9tIFwicGl4aS5qc1wiO1xuaW1wb3J0IHsgR2FtZSB9IGZyb20gXCIuL0dhbWVcIjtcblxuZXhwb3J0IHR5cGUgUG9zaXRpb24gPSB7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xufTtcblxuZXhwb3J0IHR5cGUgU2l6ZSA9IHtcbiAgd2lkdGg6IG51bWJlcjtcbiAgaGVpZ2h0OiBudW1iZXI7XG59O1xuXG5leHBvcnQgY2xhc3MgR2FtZU9iamVjdCB7XG4gIHNwcml0ZTogUElYSS5TcHJpdGU7XG4gIGdhbWU6IEdhbWU7XG4gIHVwZGF0ZVJvdGF0aW9uOiBib29sZWFuO1xuICBpZDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGlkOiBudW1iZXIsXG4gICAgcG9zaXRpb246IFBvc2l0aW9uLFxuICAgIHNpemU6IFNpemUsXG4gICAgc3ByaXRlOiBQSVhJLlNwcml0ZSxcbiAgICBnYW1lOiBHYW1lXG4gICkge1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG5cbiAgICB0aGlzLmlkID0gaWQ7XG5cbiAgICB0aGlzLnNwcml0ZSA9IHNwcml0ZTtcbiAgICB0aGlzLnNwcml0ZS5ldmVudE1vZGUgPSBcImR5bmFtaWNcIjtcblxuICAgIHRoaXMuc3ByaXRlLnBvc2l0aW9uLnggPSBwb3NpdGlvbi54O1xuICAgIHRoaXMuc3ByaXRlLnBvc2l0aW9uLnkgPSBwb3NpdGlvbi55O1xuXG4gICAgdGhpcy5zcHJpdGUuYW5jaG9yID0gMC41O1xuXG4gICAgdGhpcy5zcHJpdGUud2lkdGggPSBzaXplLndpZHRoO1xuICAgIHRoaXMuc3ByaXRlLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuXG4gICAgdGhpcy5zZXRQb3NpdGlvbihwb3NpdGlvbik7XG5cbiAgICB0aGlzLnNwcml0ZS50ZXh0dXJlLnNvdXJjZS5tYWdGaWx0ZXIgPSBcIm5lYXJlc3RcIjtcbiAgICB0aGlzLnNwcml0ZS50ZXh0dXJlLnNvdXJjZS5taW5GaWx0ZXIgPSBcIm5lYXJlc3RcIjtcblxuICAgIHRoaXMudXBkYXRlUm90YXRpb24gPSB0cnVlO1xuICB9XG5cbiAgc2V0UG9zaXRpb24ocG9zaXRpb246IFBvc2l0aW9uKSB7XG4gICAgdGhpcy5zcHJpdGUucG9zaXRpb24ueCA9IHBvc2l0aW9uLng7XG4gICAgdGhpcy5zcHJpdGUucG9zaXRpb24ueSA9IHBvc2l0aW9uLnk7XG4gIH1cblxuICB1cGRhdGUoZGVsdGFUaW1lOiBudW1iZXIpIHt9XG59XG4iLCJpbXBvcnQgeyBHYW1lT2JqZWN0LCBQb3NpdGlvbiwgU2l6ZSB9IGZyb20gXCIuL0dhbWVPYmplY3RcIjtcbmltcG9ydCB7IEZlZGVyYXRlZE1vdXNlRXZlbnQsIFNwcml0ZSB9IGZyb20gXCJwaXhpLmpzXCI7XG5pbXBvcnQgKiBhcyBQSVhJIGZyb20gXCJwaXhpLmpzXCI7XG5pbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vR2FtZVwiO1xuXG5leHBvcnQgY2xhc3MgUGxheWVyIGV4dGVuZHMgR2FtZU9iamVjdCB7XG4gIHZ4OiBudW1iZXI7XG4gIHZ5OiBudW1iZXI7XG5cbiAgX21vdXNlX3g6IG51bWJlcjtcbiAgX21vdXNlX3k6IG51bWJlcjtcblxuICBiYWxsOiBHYW1lT2JqZWN0O1xuXG4gIGJhbGxSYWRpdXM6IG51bWJlcjtcblxuICBiYWxsczogR2FtZU9iamVjdFtdO1xuXG4gIHZlbG9jaXR5OiBudW1iZXI7XG5cbiAgdGltZXI6IG51bWJlcjtcbiAgdGltZXJfc3RhcnRlZDogYm9vbGVhbjtcblxuICBnYW1lOiBHYW1lO1xuXG4gIGJhbGxfY2Q6IG51bWJlcjtcblxuICBjb25zdHJ1Y3Rvcihwb3NpdGlvbjogUG9zaXRpb24sIHNpemU6IFNpemUsIHNwcml0ZTogU3ByaXRlLCBnYW1lOiBHYW1lKSB7XG4gICAgc3VwZXIoLTEsIHBvc2l0aW9uLCBzaXplLCBzcHJpdGUsIGdhbWUpO1xuICAgIHRoaXMudXBkYXRlUm90YXRpb24gPSBmYWxzZTtcblxuICAgIHRoaXMudmVsb2NpdHkgPSAyMDtcbiAgICB0aGlzLmJhbGxSYWRpdXMgPSA1MDtcbiAgICB0aGlzLnZ4ID0gMDtcbiAgICB0aGlzLnZ5ID0gMDtcblxuICAgIHRoaXMuX21vdXNlX3ggPSAwO1xuICAgIHRoaXMuX21vdXNlX3kgPSAwO1xuXG4gICAgdGhpcy5iYWxscyA9IFtdO1xuXG4gICAgdGhpcy50aW1lciA9IDA7XG4gICAgdGhpcy5iYWxsX2NkID0gNTtcbiAgICB0aGlzLnRpbWVyX3N0YXJ0ZWQgPSBmYWxzZTtcblxuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG5cbiAgICBsZXQgYmFsbF9wb3NpdGlvbjogUG9zaXRpb24gPSB7IHg6IDAsIHk6IDAgfTtcbiAgICBiYWxsX3Bvc2l0aW9uLnggPSBwb3NpdGlvbi54O1xuICAgIGJhbGxfcG9zaXRpb24ueSA9IHBvc2l0aW9uLnkgLSA3MDtcblxuICAgIGxldCBiYWxsX3Nwcml0ZSA9IFBJWEkuU3ByaXRlLmZyb20oXCIuL2Fzc2V0cy9jaXJjbGVzL3NwaGVyZS0wMi5wbmdcIik7XG4gICAgdGhpcy5iYWxsID0gbmV3IEdhbWVPYmplY3QoXG4gICAgICAwLFxuICAgICAgYmFsbF9wb3NpdGlvbixcbiAgICAgIHsgd2lkdGg6IDUwLCBoZWlnaHQ6IDUwIH0sXG4gICAgICBiYWxsX3Nwcml0ZSxcbiAgICAgIGdhbWVcbiAgICApO1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGU6IEtleWJvYXJkRXZlbnQpID0+XG4gICAgICB0aGlzLmhhbmRsZUtleURvd24oZS5rZXkpXG4gICAgKTtcblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCAoZTogS2V5Ym9hcmRFdmVudCkgPT5cbiAgICAgIHRoaXMuaGFuZGxlS2V5VXAoZS5rZXkpXG4gICAgKTtcblxuICAgIHRoaXMuc3ByaXRlLm9uKFwiZ2xvYmFsbW91c2Vtb3ZlXCIsIChlOiBGZWRlcmF0ZWRNb3VzZUV2ZW50KSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZU1vdXNlTW92ZShlLngsIGUueSk7XG4gICAgfSk7XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZUNsaWNrKCk7XG4gICAgfSk7XG4gIH1cblxuICBoYW5kbGVNb3VzZU1vdmUobW91c2VfeDogbnVtYmVyLCBtb3VzZV95OiBudW1iZXIpIHtcbiAgICB0aGlzLl9tb3VzZV94ID0gbW91c2VfeDtcbiAgICB0aGlzLl9tb3VzZV95ID0gbW91c2VfeTtcbiAgICAvLyB0aGlzLnNwcml0ZS5wb3NpdGlvbi54ID0gbW91c2VfeDtcbiAgICAvLyB0aGlzLnNwcml0ZS5wb3NpdGlvbi55ID0gbW91c2VfeTtcbiAgICBsZXQgbWVzc2FnZSA9IHtcbiAgICAgIGlkOiB0aGlzLmdhbWUucGxheWVyX2lkLFxuICAgICAgbW91c2VfeDogdGhpcy5fbW91c2VfeCxcbiAgICAgIG1vdXNlX3k6IHRoaXMuX21vdXNlX3lcbiAgICB9O1xuICAgIHRoaXMuZ2FtZS5zZW5kTWVzc2FnZShKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XG4gIH1cblxuICBvblRpbWVyRW5kKCkge1xuICAgIGxldCBiYWxsX3Bvc2l0aW9uOiBQb3NpdGlvbiA9IHsgeDogMCwgeTogMCB9O1xuICAgIGJhbGxfcG9zaXRpb24ueCA9IHRoaXMuc3ByaXRlLng7XG4gICAgYmFsbF9wb3NpdGlvbi55ID0gdGhpcy5zcHJpdGUueSAtIDcwO1xuXG4gICAgbGV0IGJhbGxfc3ByaXRlID0gUElYSS5TcHJpdGUuZnJvbShcIi4vYXNzZXRzL2NpcmNsZXMvc3BoZXJlLTAyLnBuZ1wiKTtcbiAgICB0aGlzLmJhbGwgPSBuZXcgR2FtZU9iamVjdChcbiAgICAgIDAsXG4gICAgICBiYWxsX3Bvc2l0aW9uLFxuICAgICAgeyB3aWR0aDogNTAsIGhlaWdodDogNTAgfSxcbiAgICAgIGJhbGxfc3ByaXRlLFxuICAgICAgdGhpcy5nYW1lXG4gICAgKTtcbiAgICB0aGlzLmdhbWUuYWRkR2FtZU9iamVjdCh0aGlzLmJhbGwpO1xuICB9XG5cbiAgdXBkYXRlKGRlbHRhVGltZTogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMuYmFsbCkge1xuICAgICAgbGV0IHZlY194ID0gdGhpcy5fbW91c2VfeCAtIHRoaXMuc3ByaXRlLng7XG4gICAgICBsZXQgdmVjX3kgPSB0aGlzLl9tb3VzZV95IC0gdGhpcy5zcHJpdGUueTtcblxuICAgICAgbGV0IGxlbmd0aCA9IE1hdGguc3FydCh2ZWNfeCAqIHZlY194ICsgdmVjX3kgKiB2ZWNfeSk7XG4gICAgICB2ZWNfeCAvPSBsZW5ndGg7XG4gICAgICB2ZWNfeSAvPSBsZW5ndGg7XG5cbiAgICAgIGxldCBiYWxsX3Bvc2l0aW9uX3ggPSB0aGlzLnNwcml0ZS54ICsgdmVjX3ggKiAodGhpcy5iYWxsUmFkaXVzICsgMTApO1xuICAgICAgbGV0IGJhbGxfcG9zaXRpb25feSA9IHRoaXMuc3ByaXRlLnkgKyB2ZWNfeSAqICh0aGlzLmJhbGxSYWRpdXMgKyAxMCk7XG5cbiAgICAgIGlmIChOdW1iZXIuaXNOYU4oYmFsbF9wb3NpdGlvbl94KSB8fCBOdW1iZXIuaXNOYU4oYmFsbF9wb3NpdGlvbl95KSlcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICB0aGlzLmJhbGwuc2V0UG9zaXRpb24oeyB4OiBiYWxsX3Bvc2l0aW9uX3gsIHk6IGJhbGxfcG9zaXRpb25feSB9KTtcbiAgICAgIHRoaXMuYmFsbC51cGRhdGUoZGVsdGFUaW1lKTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBiYWxsIG9mIHRoaXMuYmFsbHMpIGJhbGwudXBkYXRlKGRlbHRhVGltZSk7XG5cbiAgICBpZiAodGhpcy50aW1lcl9zdGFydGVkKSB7XG4gICAgICB0aGlzLnRpbWVyIC09IGRlbHRhVGltZTtcbiAgICAgIGlmICh0aGlzLnRpbWVyIDwgMCkge1xuICAgICAgICB0aGlzLm9uVGltZXJFbmQoKTtcbiAgICAgICAgdGhpcy50aW1lcl9zdGFydGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgc3VwZXIudXBkYXRlKGRlbHRhVGltZSk7XG4gIH1cblxuICBoYW5kbGVDbGljaygpIHtcbiAgICBpZiAoIXRoaXMuYmFsbCkgcmV0dXJuO1xuICAgIGxldCB2ZWNfeCA9IHRoaXMuX21vdXNlX3ggLSB0aGlzLnNwcml0ZS54O1xuICAgIGxldCB2ZWNfeSA9IHRoaXMuX21vdXNlX3kgLSB0aGlzLnNwcml0ZS55O1xuXG4gICAgbGV0IGxlbmd0aCA9IE1hdGguc3FydCh2ZWNfeCAqIHZlY194ICsgdmVjX3kgKiB2ZWNfeSk7XG4gICAgdmVjX3ggLz0gbGVuZ3RoO1xuICAgIHZlY195IC89IGxlbmd0aDtcblxuICAgIGxldCBmb3JjZSA9IDYwO1xuXG4gICAgdmVjX3ggKj0gZm9yY2U7XG4gICAgdmVjX3kgKj0gZm9yY2U7XG5cbiAgICAvLyBNYXR0ZXIuQm9keS5hcHBseUZvcmNlKHRoaXMuYmFsbC5ib2R5LCB0aGlzLmJhbGwuYm9keS5wb3NpdGlvbiwge1xuICAgIC8vICAgeDogdmVjX3gsXG4gICAgLy8gICB5OiB2ZWNfeVxuICAgIC8vIH0pO1xuICAgIHRoaXMuYmFsbHMucHVzaCh0aGlzLmJhbGwpO1xuICAgIHRoaXMuYmFsbCA9IHVuZGVmaW5lZDtcblxuICAgIHRoaXMudGltZXIgPSB0aGlzLmJhbGxfY2Q7XG4gICAgdGhpcy50aW1lcl9zdGFydGVkID0gdHJ1ZTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd24oa2V5OiBzdHJpbmcpIHt9XG5cbiAgaGFuZGxlS2V5VXAoa2V5OiBzdHJpbmcpIHt9XG59XG4iLCJpbXBvcnQgKiBhcyBQSVhJIGZyb20gXCJwaXhpLmpzXCI7XG5pbXBvcnQgKiBhcyBNYXR0ZXIgZnJvbSBcIm1hdHRlci1qc1wiO1xuaW1wb3J0IHsgR2FtZU9iamVjdCB9IGZyb20gXCIuL0dhbWVPYmplY3RcIjtcbmltcG9ydCB7IEdhbWUgfSBmcm9tIFwiLi9HYW1lXCI7XG5cbmRvY3VtZW50LmJvZHkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIjMTgxODE4XCI7XG5cbmZ1bmN0aW9uIHJlbW92ZUl0ZW08VD4oYXJyOiBBcnJheTxUPiwgdmFsdWU6IFQpOiBBcnJheTxUPiB7XG4gIGNvbnN0IGluZGV4ID0gYXJyLmluZGV4T2YodmFsdWUpO1xuICBpZiAoaW5kZXggPiAtMSkge1xuICAgIGFyci5zcGxpY2UoaW5kZXgsIDEpO1xuICB9XG4gIHJldHVybiBhcnI7XG59XG5cbmNvbnN0IG1haW4gPSBhc3luYyAoKSA9PiB7XG4gIGxldCBnYW1lID0gbmV3IEdhbWUoKTtcbiAgZ2FtZS5ydW4oKTtcbn07XG5cbm1haW4oKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==